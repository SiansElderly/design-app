import{r,j as s,c as h,P as C,u,C as v,B as b,a as Y,R as E,S as Z,A as G}from"./index-BC5PDgd3.js";import{C as F,S as P,g as ee}from"./services-Cs73Tybq.js";function se(e,a){return r.Children.toArray(e).some(t=>r.isValidElement(t)&&t.type===a)}const ae={type:C.string,tooltip:C.bool,as:C.elementType},R=r.forwardRef(({as:e="div",className:a,type:t="valid",tooltip:o=!1,...l},n)=>s.jsx(e,{...l,ref:n,className:h(a,`${t}-${o?"tooltip":"feedback"}`)}));R.displayName="Feedback";R.propTypes=ae;const f=r.createContext({}),L=r.forwardRef(({id:e,bsPrefix:a,className:t,type:o="checkbox",isValid:l=!1,isInvalid:n=!1,as:c="input",...m},p)=>{const{controlId:d}=r.useContext(f);return a=u(a,"form-check-input"),s.jsx(c,{...m,ref:p,type:o,id:e||d,className:h(t,a,l&&"is-valid",n&&"is-invalid")})});L.displayName="FormCheckInput";const w=r.forwardRef(({bsPrefix:e,className:a,htmlFor:t,...o},l)=>{const{controlId:n}=r.useContext(f);return e=u(e,"form-check-label"),s.jsx("label",{...o,ref:l,htmlFor:t||n,className:h(a,e)})});w.displayName="FormCheckLabel";const O=r.forwardRef(({id:e,bsPrefix:a,bsSwitchPrefix:t,inline:o=!1,reverse:l=!1,disabled:n=!1,isValid:c=!1,isInvalid:m=!1,feedbackTooltip:p=!1,feedback:d,feedbackType:g,className:i,style:x,title:y="",type:N="checkbox",label:S,children:$,as:H="input",...J},K)=>{a=u(a,"form-check"),t=u(t,"form-switch");const{controlId:_}=r.useContext(f),Q=r.useMemo(()=>({controlId:e||_}),[_,e]),A=!$&&S!=null&&S!==!1||se($,w),X=s.jsx(L,{...J,type:N==="switch"?"checkbox":N,ref:K,isValid:c,isInvalid:m,disabled:n,as:H});return s.jsx(f.Provider,{value:Q,children:s.jsx("div",{style:x,className:h(i,A&&a,o&&`${a}-inline`,l&&`${a}-reverse`,N==="switch"&&t),children:$||s.jsxs(s.Fragment,{children:[X,A&&s.jsx(w,{title:y,children:S}),d&&s.jsx(R,{type:g,tooltip:p,children:d})]})})})});O.displayName="FormCheck";const k=Object.assign(O,{Input:L,Label:w}),B=r.forwardRef(({bsPrefix:e,type:a,size:t,htmlSize:o,id:l,className:n,isValid:c=!1,isInvalid:m=!1,plaintext:p,readOnly:d,as:g="input",...i},x)=>{const{controlId:y}=r.useContext(f);return e=u(e,"form-control"),s.jsx(g,{...i,type:a,size:o,ref:x,readOnly:d,id:l||y,className:h(n,p?`${e}-plaintext`:e,t&&`${e}-${t}`,a==="color"&&`${e}-color`,c&&"is-valid",m&&"is-invalid")})});B.displayName="FormControl";const te=Object.assign(B,{Feedback:R}),M=r.forwardRef(({className:e,bsPrefix:a,as:t="div",...o},l)=>(a=u(a,"form-floating"),s.jsx(t,{ref:l,className:h(e,a),...o})));M.displayName="FormFloating";const I=r.forwardRef(({controlId:e,as:a="div",...t},o)=>{const l=r.useMemo(()=>({controlId:e}),[e]);return s.jsx(f.Provider,{value:l,children:s.jsx(a,{...t,ref:o})})});I.displayName="FormGroup";const V=r.forwardRef(({as:e="label",bsPrefix:a,column:t=!1,visuallyHidden:o=!1,className:l,htmlFor:n,...c},m)=>{const{controlId:p}=r.useContext(f);a=u(a,"form-label");let d="col-form-label";typeof t=="string"&&(d=`${d} ${d}-${t}`);const g=h(l,a,o&&"visually-hidden",t&&d);return n=n||p,t?s.jsx(v,{ref:m,as:"label",className:g,htmlFor:n,...c}):s.jsx(e,{ref:m,className:g,htmlFor:n,...c})});V.displayName="FormLabel";const D=r.forwardRef(({bsPrefix:e,className:a,id:t,...o},l)=>{const{controlId:n}=r.useContext(f);return e=u(e,"form-range"),s.jsx("input",{...o,type:"range",ref:l,className:h(a,e),id:t||n})});D.displayName="FormRange";const U=r.forwardRef(({bsPrefix:e,size:a,htmlSize:t,className:o,isValid:l=!1,isInvalid:n=!1,id:c,...m},p)=>{const{controlId:d}=r.useContext(f);return e=u(e,"form-select"),s.jsx("select",{...m,size:t,ref:p,className:h(o,e,a&&`${e}-${a}`,l&&"is-valid",n&&"is-invalid"),id:c||d})});U.displayName="FormSelect";const W=r.forwardRef(({bsPrefix:e,className:a,as:t="small",muted:o,...l},n)=>(e=u(e,"form-text"),s.jsx(t,{...l,ref:n,className:h(a,e,o&&"text-muted")})));W.displayName="FormText";const q=r.forwardRef((e,a)=>s.jsx(k,{...e,ref:a,type:"switch"}));q.displayName="Switch";const re=Object.assign(q,{Input:k.Input,Label:k.Label}),z=r.forwardRef(({bsPrefix:e,className:a,children:t,controlId:o,label:l,...n},c)=>(e=u(e,"form-floating"),s.jsxs(I,{ref:c,className:h(a,e),controlId:o,...n,children:[t,s.jsx("label",{htmlFor:o,children:l})]})));z.displayName="FloatingLabel";const oe={_ref:C.any,validated:C.bool,as:C.elementType},T=r.forwardRef(({className:e,validated:a,as:t="form",...o},l)=>s.jsx(t,{...o,ref:l,className:h(e,a&&"was-validated")}));T.displayName="Form";T.propTypes=oe;const j=Object.assign(T,{Group:I,Control:te,Floating:M,Check:k,Switch:re,Label:V,Text:W,Range:D,Select:U,FloatingLabel:z});function le({service:e}){const a=e.screenshot?e.screenshot.startsWith("/")?`/${e.screenshot}`:e.screenshot:"/default-service.jpg";return s.jsxs(F,{className:"mb-4 shadow-sm h-100",children:[s.jsx(F.Img,{variant:"top",src:a,alt:e.name,style:{height:"200px",objectFit:"cover"},onError:t=>{t.target.src="/default-service.jpg"}}),s.jsxs(F.Body,{className:"d-flex flex-column bg-primary-light",children:[s.jsx(F.Title,{children:e.name}),s.jsxs(F.Text,{className:"text-muted",children:["Категория: ",e.category,s.jsx("br",{}),"Цена: ",e.price," ₽",s.jsx("br",{}),"Сложность: ",e.complexity_level==="easy"?"★☆☆":e.complexity_level==="medium"?"★★☆":"★★★"]}),s.jsx(b,{style:{backgroundColor:"#5A8F9C",color:"white"},href:`/services/${e.id}`,className:"mt-auto",children:"Подробнее"})]})]})}function ie(){const[e,a]=r.useState([]),[t,o]=r.useState(!0),[l,n]=r.useState(null),[c,m]=r.useState({});r.useEffect(()=>{(async()=>{try{o(!0),n(null);const x=await P.getAll({category:c.category,price_min:c.minPrice,price_max:c.maxPrice});a(x)}catch(x){console.error("Ошибка загрузки:",x),n("Не удалось загрузить услуги. Показаны mock-данные");const y=await ee({category:c.category,price_min:c.minPrice,price_max:c.maxPrice});a(y.services)}finally{o(!1)}})()},[c]);const p=(i,x)=>{const y=x?parseFloat(x):void 0;m(N=>({...N,[i]:y}))},d=()=>{m({})},g=[...new Set(e.map(i=>i.category))];return s.jsxs(Y,{className:"py-4",children:[s.jsx("h1",{className:"mb-4",children:"Каталог услуг"}),s.jsx(j,{className:"mb-4 p-3 bg-light rounded",children:s.jsxs(E,{children:[s.jsx(v,{md:4,children:s.jsxs(j.Group,{children:[s.jsx(j.Label,{children:"Категория"}),s.jsxs(j.Select,{value:c.category||"",onChange:i=>m({...c,category:i.target.value||void 0}),children:[s.jsx("option",{value:"",children:"Все категории"}),g.map(i=>s.jsx("option",{value:i,children:i},i))]})]})}),s.jsx(v,{md:3,children:s.jsxs(j.Group,{children:[s.jsx(j.Label,{children:"Цена от"}),s.jsx(j.Control,{type:"number",value:c.minPrice??"",onChange:i=>p("minPrice",i.target.value),placeholder:"Минимальная цена",min:"0",step:"0.01"})]})}),s.jsx(v,{md:3,children:s.jsxs(j.Group,{children:[s.jsx(j.Label,{children:"Цена до"}),s.jsx(j.Control,{type:"number",value:c.maxPrice??"",onChange:i=>p("maxPrice",i.target.value),placeholder:"Максимальная цена",min:"0",step:"0.01"})]})}),s.jsx(v,{md:2,className:"d-flex align-items-end",children:s.jsx(b,{variant:"outline-secondary",onClick:d,className:"w-100",children:"Сбросить"})})]})}),t?s.jsxs("div",{className:"text-center py-5",children:[s.jsx(Z,{animation:"border",variant:"primary"}),s.jsx("p",{children:"Загрузка услуг..."})]}):l?s.jsxs(G,{variant:"danger",className:"mb-4",children:[l,s.jsx("div",{className:"mt-2",children:s.jsx(b,{variant:"primary",onClick:()=>window.location.reload(),children:"Попробовать снова"})})]}):e.length===0?s.jsx(G,{variant:"info",children:"Услуги не найдены. Попробуйте изменить параметры фильтрации."}):s.jsx(E,{xs:1,md:2,lg:3,className:"g-4",children:e.map(i=>s.jsx(v,{children:s.jsx(le,{service:i})},i.id))})]})}export{ie as default};
